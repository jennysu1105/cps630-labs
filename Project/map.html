<!DOCTYPE html>
<html>

<head>
    <title>Smart Customer Services</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="styles/map.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <script src="scripts/nav.js"></script>
    <script src="scripts/index.js"></script>
</head>

<body style="background-color: #b2edc2;">
  <nav-bar></nav-bar>
  <div class="container">
    <div class="row mt-4" >
      <div class="col-md-4" style="background-color:lavender;">
        <div class="row gx-0">
          <div>First name:</div><input type="text" name="fname"><br>
          <div>Last name:</div><input type="text" name="lname" ><br>
          <div>Phone number:</div><input type="text" name="phone-number"><br>
          <div>Provines & Territories:</div>
          <select name="province" id="province" onchange="changeProvince()">
            <option value="Alberta">Alberta</option>
            <option value="British Columbia">British Columbia</option>
            <option value="Manitoba">Manitoba</option>
            <option value="New Brunswick">New Brunswick</option>
            <option value="Newfoundland and Labrador">Newfoundland and Labrador</option>
            <option value="Nova Scotia">Nova Scotia</option>
            <option value="Northwest Territories">Northwest Territories</option>
            <option value="Nunavut">Nunavut</option>
            <option value="Ontario">Ontario</option>
            <option value="Prince Edward Island">Prince Edward Island</option>
            <option value="Quebec">Quebec</option>
            <option value="Saskatchewan">Saskatchewan</option>
            <option value="Yukon">Yukon</option>
          </select>
          <div>City: </div><input type="text" name="city" id="city" onchange="changeCity()"><br>
          <div>Delivery Address:</div><input type="text" name="address" id="end"><br>
        </div>
        <div>Branch:</div>
        <select id="start">
          <option value="PGGX+54 Toronto, Ontario">Yorkdale</option>
          <option value="MJ39+QP Toronto, Ontario">Eatons</option>
          <option value="MH47+8P Toronto, Ontario">Dufferin Mall</option>
        </select>
        <input type="submit">
        <!-- <b>Delivered To: </b>
        <select id="end">
          <option value="MG98+65 Toronto, Ontario">TEST1</option>
          <option value="PG5G+CJ Toronto, Ontario">TEST2</option>
          <option value="PFCQ+XG North York, Toronto, ON">TEST3</option>
        </select>  -->
      </div>
      <div class="col-md-8" style="background-color:lavenderblush;">
        <div id="map"></div>
      </div>
    </div>
  </div>

  
    <!-- <div id="floating-panel">
        <b>Start: </b>
        <select id="start">
          <option value="1768 St. Clair Avenue West">Pho Xua</option>
          <option value="MG3M+G6 Toronto, Ontario">St Louis</option>
          <option value="MHV3+C3 York, Toronto, ON">Joplin, MO</option>
        </select>
        <b>End: </b>
        <select id="end">
          <option value="PGGX+54 Toronto, Ontario">Yorkdale</option>
          <option value="MJ39+QP Toronto, Ontario">Eatons Centre</option>
          <option value="MH47+8P Toronto, Ontario">Dufferin Mall</option>
        </select>
      </div>
    <div id="map"></div> -->

    <!-- Map -->

    <script>
      const directionsService = new google.maps.DirectionsService();
      const directionsRenderer = new google.maps.DirectionsRenderer();
      var theMap = new google.maps.Map();
      var province = "";
      var city = "";

      function initMap(){
        const map = new google.maps.Map(document.getElementById("map"), {
            zoom: 3,
            center: { lat: 59.105890, lng: -102.005848}
        });
        theMap = map;
      }

      function changeProvince(){
        var geocoder = new google.maps.Geocoder();
        province = document.getElementById("province").value;
        geocoder.geocode({address: province}).then((response) => {
            if(response.results[0]){
                var theJson = JSON.parse(JSON.stringify(response, null, 2))
                theMap.panTo({lat: theJson.results[0].geometry.location.lat, lng: theJson.results[0].geometry.location.lng });
                theMap.setZoom(5);
                city = ""; 
                document.getElementById("city").value = "";
            }else{
                window.alert("No results found");
            }
        });
      }
      
      function changeCity(){
        var geocoder = new google.maps.Geocoder();
        city = document.getElementById("city").value;
        var provCity = province + " " + city;
        console.log(provCity);
        geocoder.geocode({address: provCity}).then((response) => {
            if(response.results[0]){
                var theJson = JSON.parse(JSON.stringify(response, null, 2))
                console.log(theJson);
                theMap.panTo({lat: theJson.results[0].geometry.location.lat, lng: theJson.results[0].geometry.location.lng });
                theMap.setZoom(11);
            }else{
                window.alert("No results found");
            }
        });
      }


      // function initMap() {
      //     const directionsService = new google.maps.DirectionsService();
      //     const directionsRenderer = new google.maps.DirectionsRenderer();
          // const map = new google.maps.Map(document.getElementById("map"), {
          //     zoom: 13,
          //     center: { lat: 43.671916, lng: -79.427061 },
          // });

      //     directionsRenderer.setMap(map);

      //     const onChangeHandler = function () {
      //         calculateAndDisplayRoute(directionsService, directionsRenderer);
      //     };

      //     document.getElementById("start").addEventListener("change", onChangeHandler);
      //     document.getElementById("end").addEventListener("change", onChangeHandler);
      // }

      function calculateAndDisplayRoute(directionsService, directionsRenderer) {
        console.log(document.getElementById('end').value.length == 0)
        if(document.getElementById('end').value.length !== 0){
          directionsService
          .route({
            origin: {
              query: document.getElementById("start").value,
            },
            destination: {
              query: document.getElementById("end").value,
            },
            travelMode: google.maps.TravelMode.DRIVING,
          })
          .then((response) => {
            directionsRenderer.setDirections(response);
          })
          .catch((e) => window.alert("Directions request failed due to " + status));
        }else{
          alert("No delivery address added!")
        }
      }

      // function getLocation(){
      //   calculateAndDisplayRoute(directionsService, directionsRenderer);
      // }

      window.initMap = initMap;
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCLherBXiXAewyPuGAs-5Hs47p0-_D7VcQ&callback=initMap"></script>
</body>

</html>